import{k as x,u as A,r as v,J as S,m as d,o as w,d as q,q as t,w as l,g,s as y,b as K,E as p,e as $,K as J,l as R,i as N,B as D}from"./index-D3CIYbn5.js";import{C as _}from"./index-Cbqa3_MS.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";function M(){return x.put("/getPwdAesKey")}function P(a,s){const r=_.enc.Utf8.parse(a);return _.AES.encrypt(r,_.enc.Utf8.parse(s),{mode:_.mode.CBC,padding:_.pad.Pkcs7,iv:_.enc.Utf8.parse(s)}).toString()}function I(a,s,r){return x.post("/resetPwd",{oldPwd:P(a,r),newPwd:P(s,r)})}function j(a,s){return x.post("/setPwd",{pwd:P(a,s)})}function z(a,s){return x.post("/delPwd",{pwd:P(a,s)})}const G={__name:"setPsw",props:{keys:{type:String,default:""}},setup(a){const s=K(),r=A(),e=a,n=v(!0),i=S({psw:""}),b={psw:{required:!0,message:"请输入密码",trigger:"blur"}};async function B(){if(i.psw==""){p.error("请输入密码");return}let k=await j(i.psw,e.keys);console.log(k),p.success("设置密码成功"),n.value=!0,r.pswCheck(),s.push("/")}return(k,V)=>{const U=d("el-input"),C=d("el-form-item"),c=d("el-button"),o=d("el-form");return w(),q("div",null,[t(o,{model:i,rules:b},{default:l(()=>[t(C,{label:"设置密码",prop:"psw","label-width":"120"},{default:l(()=>[t(U,{modelValue:i.psw,"onUpdate:modelValue":V[0]||(V[0]=m=>i.psw=m),"show-password":""},null,8,["modelValue"])]),_:1}),t(C,{"label-width":"120"},{default:l(()=>[n.value?(w(),g(c,{key:0,type:"primary",onClick:B},{default:l(()=>[y("提交")]),_:1})):(w(),g(c,{key:1,type:"primary"},{default:l(()=>[y("提交中...")]),_:1}))]),_:1})]),_:1},8,["model"])])}}},H={class:"clear"},L={__name:"pswConfig",props:{keys:{type:String,default:""}},setup(a){const s=K(),r=v(!0),e=v({oldpsw:"",newpsw:"",newpsw2:""}),n=v({pwd:""}),i=S({pwd:{required:!0,message:"请输入密码",trigger:"blur"}}),b=v(!1),B=a,k=S({oldpsw:{required:!0,message:"请输入旧密码",trigger:"blur"},newpsw:{required:!0,message:"请输入新密码",trigger:"blur"},newpsw2:{required:!0,message:"请输入新密码",trigger:"blur"}});async function V(){if(e.value.oldpsw==""){p.error("请输入旧密码");return}if(e.value.newpsw==""){p.error("请输入新密码");return}if(e.value.newpsw!==e.value.newpsw2){p.error("两次输入密码不一致");return}r.value=!1,await I(e.value.oldpsw,e.value.newpsw,B.keys),r.value=!0,sessionStorage.clear(),p.success("密码修改成功，请重新登录"),s.push("/")}function U(){if(n.value.pwd==""){p.error("请输入密码");return}J.confirm("确认清除密码?",{distinguishCancelAndClose:!0,confirmButtonText:"确认",cancelButtonText:"取消"}).then(async()=>{try{let{key:c}=await M(),{msg:o}=await z(n.value.pwd,c);p.success(o),s.push("/")}catch{}}).catch(()=>{p.info("已取消")})}function C(){n.value.pwd=""}return(c,o)=>{const m=d("el-input"),f=d("el-form-item"),h=d("el-button"),E=d("el-form"),T=d("el-dialog");return w(),q("div",null,[t(T,{modelValue:b.value,"onUpdate:modelValue":o[1]||(o[1]=u=>b.value=u)},{default:l(()=>[t(E,{model:n.value,rules:i,onClose:C},{default:l(()=>[t(f,{label:"密码","label-width":"120",prop:"pwd"},{default:l(()=>[t(m,{modelValue:n.value.pwd,"onUpdate:modelValue":o[0]||(o[0]=u=>n.value.pwd=u),"show-password":""},null,8,["modelValue"])]),_:1}),t(f,{"label-width":"120"},{default:l(()=>[t(h,{onClick:U},{default:l(()=>[y("清除密码")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),$("div",H,[t(h,{type:"danger",onClick:o[2]||(o[2]=u=>b.value=!0)},{default:l(()=>[y("清除密码")]),_:1})]),t(E,{rules:k,model:e.value},{default:l(()=>[t(f,{label:"旧密码","label-width":"120",prop:"oldpsw"},{default:l(()=>[t(m,{modelValue:e.value.oldpsw,"onUpdate:modelValue":o[3]||(o[3]=u=>e.value.oldpsw=u),"show-password":""},null,8,["modelValue"])]),_:1}),t(f,{label:"新密码","label-width":"120",prop:"newpsw"},{default:l(()=>[t(m,{modelValue:e.value.newpsw,"onUpdate:modelValue":o[4]||(o[4]=u=>e.value.newpsw=u),"show-password":""},null,8,["modelValue"])]),_:1}),t(f,{label:"确认新密码","label-width":"120",prop:"newpsw2"},{default:l(()=>[t(m,{modelValue:e.value.newpsw2,"onUpdate:modelValue":o[5]||(o[5]=u=>e.value.newpsw2=u),"show-password":""},null,8,["modelValue"])]),_:1}),t(f,{"label-width":"120"},{default:l(()=>[r.value?(w(),g(h,{key:0,type:"primary",onClick:V},{default:l(()=>[y("提交")]),_:1})):(w(),g(h,{key:1,type:"primary"},{default:l(()=>[y("提交中...")]),_:1}))]),_:1})]),_:1},8,["rules","model"])])}}},O=F(L,[["__scopeId","data-v-9f3a6619"]]),Y={__name:"pswSet",setup(a){const s=A(),r=v("");return R(async()=>{let e=await M();r.value=e.key}),(e,n)=>(w(),q("div",null,[N(s).psw==0?(w(),g(G,{key:0,keys:r.value},null,8,["keys"])):N(s).psw==1?(w(),g(O,{key:1,keys:r.value},null,8,["keys"])):D("",!0)]))}};export{Y as default};
